<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fnaf IRL v9.0 LAN Auto-Connect</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        :root {
            --neon-green: #00ff41;
            --neon-red: #ff003c;
            --neon-purple: #d600ff;
            --neon-gold: #ffd700;
            --freddy-brown: #8b4513;
        }
        
        body { background: #050505; color: var(--neon-green); font-family: 'Courier New', monospace; margin: 0; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; user-select: none; }

        /* --- –í–•–û–î–ù–û–ï –ú–ï–ù–Æ --- */
        #setupOverlay { position: fixed; inset: 0; background: #000; z-index: 5000; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 30px; }
        .title { font-size: 4rem; text-shadow: 0 0 20px var(--neon-green); margin-bottom: 20px; text-transform: uppercase; font-weight: bold; }
        
        .start-btn { 
            padding: 20px 50px; 
            border: 2px solid var(--neon-green); 
            background: rgba(0, 255, 65, 0.05); 
            color: var(--neon-green); 
            font-size: 1.5rem; 
            cursor: pointer; 
            text-transform: uppercase; 
            font-family: inherit; 
            transition: 0.3s;
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.2);
        }
        .start-btn:hover { background: var(--neon-green); color: #000; box-shadow: 0 0 40px var(--neon-green); transform: scale(1.05); }

        /* --- –ò–ù–¢–ï–†–§–ï–ô–° –•–û–°–¢–ê --- */
        .terminal { 
            width: 95%; max-width: 700px; 
            border: 2px solid #222; 
            padding: 20px; 
            background: #000; 
            box-shadow: 0 0 30px rgba(0, 255, 65, 0.1);
            display: none;
        }

        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        
        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ */
        #settingsBox { display: none; background: #111; border: 1px solid var(--neon-green); padding: 15px; margin-bottom: 20px; animation: slideDown 0.3s ease; }
        .setting-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-size: 1.2rem; }
        input { background: #000; border: 1px solid var(--neon-green); color: var(--neon-green); padding: 5px; font-family: inherit; width: 60px; text-align: center; font-size: 1.2rem; }

        /* –°–µ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        
        .btn { 
            padding: 20px; 
            background: #080808; 
            border: 1px solid #444; 
            color: #888; 
            font-weight: bold; 
            cursor: pointer; 
            text-transform: uppercase; 
            font-family: inherit; 
            transition: 0.2s;
            font-size: 1rem;
            position: relative;
            overflow: hidden;
        }
        
        /* –¶–≤–µ—Ç–∞ –∫–Ω–æ–ø–æ–∫ –∏ –∞–Ω–∏–º–∞—Ü–∏–∏ */
        .btn:hover { border-color: var(--neon-green); color: var(--neon-green); box-shadow: 0 0 15px rgba(0,255,65,0.3); }
        .btn:active { transform: scale(0.98); background: #111; }
        
        /* –ê–∫—Ç–∏–≤–Ω—ã–µ —Ä–µ–∂–∏–º—ã */
        .btn.mode-active { background: var(--neon-green) !important; color: #000 !important; box-shadow: 0 0 30px var(--neon-green); }

        /* –û—Å–æ–±—ã–µ –∫–Ω–æ–ø–∫–∏ */
        .btn-night { border-color: var(--neon-purple); color: var(--neon-purple); }
        .btn-night.active { background: var(--neon-purple) !important; color: #fff !important; animation: pulse 0.8s infinite; }
        
        .btn-freddy { border-color: var(--freddy-brown); color: var(--freddy-brown); }
        .btn-freddy:hover { background: var(--freddy-brown); color: #fff; box-shadow: 0 0 20px var(--freddy-brown); }
        
        .btn-red { border-color: var(--neon-red); color: var(--neon-red); }
        .btn-red:hover { background: var(--neon-red); color: #fff; box-shadow: 0 0 20px var(--neon-red); }
        
        .btn-gold { border-color: var(--neon-gold); color: var(--neon-gold); }
        .btn-gold:hover { background: var(--neon-gold); color: #000; box-shadow: 0 0 30px var(--neon-gold); }

        /* --- –ò–ù–¢–ï–†–§–ï–ô–° –ò–ì–†–û–ö–ê --- */
        #playerUI { display: none; width: 100%; height: 100%; flex-direction: column; justify-content: center; align-items: center; }
        #clock { font-size: 20vw; text-shadow: 0 0 40px var(--neon-green); z-index: 10; }
        #waitMsg { font-size: 2rem; animation: blink 2s infinite; color: #666; }
        
        #screamImg { display: none; position: fixed; inset: 0; width: 100%; height: 100%; object-fit: cover; z-index: 9999; }
        #winScreen { display: none; position: fixed; inset: 0; background: #000; z-index: 10000; flex-direction: column; justify-content: center; align-items: center; }
        
        /* –§–û–ù–ê–†–ò–ö */
        #flashBtn { 
            display: none; position: fixed; bottom: 10%; left: 50%; transform: translateX(-50%);
            width: 220px; height: 220px; border-radius: 50%;
            background: var(--neon-gold); border: 8px solid #fff;
            box-shadow: 0 0 60px var(--neon-gold);
            color: #000; font-weight: bold; font-size: 1.8rem;
            cursor: pointer; z-index: 8000;
            animation: shake 0.5s infinite;
        }
        #flashBtn:active { transform: translateX(-50%) scale(0.95); background: #fff; }

        /* –ê–ù–ò–ú–ê–¶–ò–ò */
        @keyframes pulse { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.8; transform: scale(1.05); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes shake { 0% { transform: translate(-52%, 0); } 50% { transform: translate(-48%, 0); } 100% { transform: translate(-50%, 0); } }

        /* –õ–æ–≥ */
        #hostStatusLog { margin-top: 20px; padding: 10px; border-top: 1px solid #333; text-align: center; color: #555; font-size: 0.9rem; }
    </style>
</head>
<body>

    <div id="setupOverlay">
        <div class="title">FNAF IRL v9.0</div>
        <button class="start-btn" onclick="initHost()">–°–û–ó–î–ê–¢–¨ –ö–û–ú–ù–ê–¢–£</button>
        <button class="start-btn" onclick="initPlayer()">–ü–û–î–ö–õ–Æ–ß–ò–¢–¨–°–Ø (AUTO)</button>
        <div style="color:#444; font-size: 0.8rem; margin-top: 20px;">* –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å–µ—Ç–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç</div>
    </div>

    <div id="hostUI" class="terminal">
        <div class="header-bar">
            <div style="font-size: 1.2rem; font-weight: bold;">ADMIN PANEL</div>
            <div>
                <span id="statusTxt" style="color:var(--neon-red); margin-right: 15px;">OFFLINE</span>
                <button onclick="toggleSettings()" class="btn" style="padding: 5px 10px; font-size: 1.2rem;">‚öôÔ∏è</button>
            </div>
        </div>

        <div id="settingsBox">
            <div class="setting-row">
                <span>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —á–∞—Å–∞:</span>
                <div>
                    <input type="number" id="mInp" value="1"> –º 
                    <input type="number" id="sInp" value="30"> —Å
                </div>
            </div>
            <div class="setting-row">
                <span>–î–µ–π—Å—Ç–≤–∏—è:</span>
                <button class="btn btn-gold" onclick="finishNight()" style="padding: 10px 20px;">WIN (6 AM)</button>
            </div>
            <button class="btn" style="width: 100%; border-color: var(--neon-green); color: var(--neon-green);" onclick="startNight()">–ù–ê–ß–ê–¢–¨ –ù–û–ß–¨</button>
        </div>

        <div class="grid">
            <button class="btn" onclick="playHostSound('door')">STEPS</button>
            <button class="btn" onclick="playHostSound('closet')">BREATH</button>
            
            <button id="btn-normal" class="btn" onclick="setMode('normal')">NORMAL MODE</button>
            <button id="btn-hard" class="btn" onclick="setMode('hard')">HARD MODE</button>
            
            <button id="btn-night" class="btn btn-night" onclick="toggleNightmare()">NIGHTMARE</button>
            <button id="btn-freddy" class="btn btn-freddy" onclick="triggerFreddy()">FREDDY (–§–û–ù–ê–†–¨)</button>
            
            <button class="btn btn-red" onclick="killPlayer('default')">–°–ö–†–ò–ú–ï–†</button>
            <button class="btn btn-red" onclick="stopAll()">–°–¢–û–ü (–°–ë–†–û–°)</button>
        </div>
        
        <div id="hostStatusLog">–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞...</div>
    </div>

    <div id="playerUI">
        <div id="waitMsg">–ü–û–ò–°–ö –•–û–°–¢–ê...</div>
        <div id="clock">12:00</div>
        <button id="flashBtn" onclick="useFlashlight()">–§–û–ù–ê–†–¨!</button>
        
        <img id="screamImg" src="" alt="">
        <div id="winScreen"><div style="font-size:12rem;">üëë</div><div style="color:var(--neon-gold); font-size:4rem;">6 AM</div></div>
    </div>

    <div style="display:none;">
        <audio id="snd-door" src="door.mp3" preload="auto"></audio>
        <audio id="snd-closet" src="closet.mp3" preload="auto"></audio>
        <audio id="snd-window" src="window.mp3" preload="auto"></audio>
        <audio id="snd-nightmare" src="nightmare.mp3" loop preload="auto"></audio>
        <audio id="snd-freddy" src="freddy.mp3" preload="auto"></audio>
        <audio id="snd-flashlight" src="flashlight.mp3" preload="auto"></audio>
        <audio id="snd-win" src="win.mp3" preload="auto"></audio>
    </div>

    <script>
        // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
        // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ID –¥–ª—è –∞–≤—Ç–æ-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–∫–∞–∫ –±—É–¥—Ç–æ LAN)
        const FIXED_ROOM_ID = "fnaf-irl-local-server-v9"; 
        
        let peer, conn, timerInt, gameHour = 0;
        let activeMode = null, loopActive = false;
        let freddyTimer = null, nightmareTimer = null;

        // --- –õ–û–ì–ò–†–û–í–ê–ù–ò–ï ---
        function log(msg, color="#888") {
            const el = document.getElementById('hostStatusLog');
            el.innerText = msg; el.style.color = color;
        }

        function toggleSettings() {
            const b = document.getElementById('settingsBox');
            b.style.display = (b.style.display === 'block') ? 'none' : 'block';
        }

        // --- –ê–£–î–ò–û –î–í–ò–ñ–û–ö ---
        function playHostSound(name) {
            // –ò–≥—Ä–∞–µ—Ç –∑–≤—É–∫ —É —Ö–æ—Å—Ç–∞
            const a = document.getElementById('snd-' + name);
            if(a) { a.currentTime = 0; a.play().catch(e => console.log("Audio Error:", e)); }
        }

        function stopLocalAudio() {
            document.querySelectorAll('audio').forEach(a => {
                if(a.id !== 'snd-window' && a.id !== 'snd-win') { a.pause(); a.currentTime = 0; }
            });
        }

        // --- –°–ï–¢–ï–í–ê–Ø –ß–ê–°–¢–¨ ---
        function initHost() {
            document.getElementById('setupOverlay').style.display = 'none';
            document.getElementById('hostUI').style.display = 'block';
            
            // –°–æ–∑–¥–∞–µ–º —Å–µ—Ä–≤–µ—Ä —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∏–º–µ–Ω–µ–º
            peer = new Peer(FIXED_ROOM_ID);
            
            peer.on('open', () => {
                log("–°–ï–†–í–ï–† –ó–ê–ü–£–©–ï–ù. –ñ–î–£ –ò–ì–†–û–ö–ê...", "var(--neon-gold)");
            });

            peer.on('error', (err) => {
                if(err.type === 'unavailable-id') {
                    alert("–û—à–∏–±–∫–∞: –ö–æ–º–Ω–∞—Ç–∞ –∑–∞–Ω—è—Ç–∞ –∏–ª–∏ –Ω–µ –∑–∞–∫—Ä—ã—Ç–∞ –ø—Ä–æ—à–ª–∞—è —Å–µ—Å—Å–∏—è. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥.");
                } else {
                    log("–û–®–ò–ë–ö–ê –°–ï–¢–ò: " + err.type, "red");
                }
            });

            peer.on('connection', c => {
                conn = c;
                document.getElementById('statusTxt').innerText = "CONNECTED";
                document.getElementById('statusTxt').style.color = "var(--neon-green)";
                log("–ò–ì–†–û–ö –ü–û–î–ö–õ–Æ–ß–ò–õ–°–Ø!", "var(--neon-green)");
                
                // –°–ª—É—à–∞–µ–º –æ—Ç–≤–µ—Ç—ã –æ—Ç –∏–≥—Ä–æ–∫–∞
                conn.on('data', d => {
                    if(d.action === 'freddy_safe') {
                        playHostSound('flashlight');
                        log("–ò–ì–†–û–ö –û–¢–ü–£–ì–ù–£–õ –§–†–ï–î–î–ò", "var(--neon-gold)");
                    }
                    if(d.action === 'freddy_die') {
                        log("–§–†–ï–î–î–ò –ü–û–ô–ú–ê–õ –ò–ì–†–û–ö–ê", "red");
                    }
                });
            });
        }

        function initPlayer() {
            document.getElementById('setupOverlay').style.display = 'none';
            document.getElementById('playerUI').style.display = 'flex';
            
            peer = new Peer(); // –°–ª—É—á–∞–π–Ω—ã–π ID –¥–ª—è –∏–≥—Ä–æ–∫–∞
            
            peer.on('open', () => {
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É ID
                conn = peer.connect(FIXED_ROOM_ID);
                
                conn.on('open', () => {
                    document.getElementById('waitMsg').innerText = "–°–í–Ø–ó–¨ –£–°–¢–ê–ù–û–í–õ–ï–ù–ê!";
                    document.getElementById('waitMsg').style.color = "var(--neon-green)";
                });

                conn.on('error', () => {
                    document.getElementById('waitMsg').innerText = "–•–û–°–¢ –ù–ï –ù–ê–ô–î–ï–ù...";
                    setTimeout(initPlayer, 3000); // –†–µ–∫–æ–Ω–Ω–µ–∫—Ç
                });

                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –æ—Ç –•–æ—Å—Ç–∞
                conn.on('data', data => {
                    const el = {
                        img: document.getElementById('screamImg'),
                        clock: document.getElementById('clock'),
                        win: document.getElementById('winScreen'),
                        flash: document.getElementById('flashBtn')
                    };

                    if(data.action === 'start') {
                        el.win.style.display = 'none';
                        el.img.style.display = 'none';
                        el.clock.style.display = 'block';
                        el.clock.innerText = "12:00";
                        el.flash.style.display = 'none';
                    }
                    
                    if(data.action === 'time') el.clock.innerText = data.h + ":00";
                    
                    if(data.action === 'kill') {
                        el.clock.style.display = 'none';
                        el.flash.style.display = 'none';
                        el.img.style.display = 'block';
                        
                        // –í—ã–±–æ—Ä –∫–∞—Ä—Ç–∏–Ω–∫–∏
                        let src = 'screamer.png';
                        if(data.type === 'nightmare') src = 'nightmare.png';
                        if(data.type === 'freddy') src = 'freddy.png';
                        
                        el.img.src = src + "?t=" + Date.now();
                        setTimeout(() => el.img.style.display = 'none', 4000);
                    }

                    if(data.action === 'freddy_trigger') {
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Ñ–æ–Ω–∞—Ä–∏–∫–∞
                        el.flash.style.display = 'block';
                        // –ó–∞–ø—É—Å–∫–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π —Ç–∞–π–º–µ—Ä —Å–º–µ—Ä—Ç–∏ —É –∏–≥—Ä–æ–∫–∞ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
                        freddyTimer = setTimeout(() => {
                            if(el.flash.style.display === 'block') {
                                el.flash.style.display = 'none';
                                el.img.style.display = 'block';
                                el.img.src = 'freddy.png';
                                conn.send({action: 'freddy_die'});
                            }
                        }, 10000); // 10 —Å–µ–∫ –Ω–∞ —Ä–µ–∞–∫—Ü–∏—é
                    }

                    if(data.action === 'win') {
                        el.win.style.display = 'flex';
                        el.flash.style.display = 'none';
                    }

                    if(data.action === 'stop') {
                        el.clock.innerText = "STOP";
                        el.flash.style.display = 'none';
                        clearTimeout(freddyTimer);
                    }
                });
            });
        }

        // --- –õ–û–ì–ò–ö–ê –ò–ì–†–´ --- //
        
        function startNight() {
            if(!conn) return alert("–ñ–¥–µ–º –∏–≥—Ä–æ–∫–∞!");
            gameHour = 0;
            conn.send({action: 'start'});
            startClock();
            document.getElementById('settingsBox').style.display = 'none';
            log("–ù–û–ß–¨ –ù–ê–ß–ê–õ–ê–°–¨");
        }

        function startClock() {
            clearInterval(timerInt);
            const m = parseInt(document.getElementById('mInp').value) || 1;
            const s = parseInt(document.getElementById('sInp').value) || 30;
            const ms = (m * 60 + s) * 1000;
            
            timerInt = setInterval(() => {
                gameHour++;
                conn.send({action: 'time', h: gameHour});
                if(gameHour >= 6) { 
                    clearInterval(timerInt); 
                    setTimeout(finishNight, 2500); 
                }
            }, ms);
        }

        function stopAll() {
            clearInterval(timerInt);
            stopLocalAudio();
            loopActive = false; activeMode = null;
            clearTimeout(nightmareTimer);
            
            // –°–±—Ä–æ—Å UI
            document.querySelectorAll('.btn').forEach(b => b.classList.remove('mode-active'));
            document.getElementById('btn-night').classList.remove('active');
            
            if(conn) conn.send({action: 'stop'});
            log("–ò–ì–†–ê –û–°–¢–ê–ù–û–í–õ–ï–ù–ê", "var(--neon-red)");
        }

        function setMode(mode) {
            if(activeMode === mode) { stopAll(); return; }
            stopAll();
            activeMode = mode; loopActive = true;
            document.getElementById('btn-'+mode).classList.add('mode-active');
            log("–†–ï–ñ–ò–ú: " + mode.toUpperCase());
            modeLoop();
        }

        async function modeLoop() {
            if(!loopActive) return;
            const sounds = ['door', 'closet'];
            const snd = sounds[Math.floor(Math.random() * sounds.length)];
            playHostSound(snd);
            
            await new Promise(r => setTimeout(r, 2000));
            
            if(loopActive) {
                const delay = activeMode === 'normal' ? (Math.random()*3000 + 2000) : 1000;
                setTimeout(modeLoop, delay);
            }
        }

        // --- –ú–ï–•–ê–ù–ò–ö–ò –£–ë–ò–ô–°–¢–í --- //

        function toggleNightmare() {
            const btn = document.getElementById('btn-night');
            if(btn.classList.contains('active')) {
                stopAll();
            } else {
                stopAll();
                playHostSound('nightmare');
                btn.classList.add('active');
                log("NIGHTMARE –ê–ö–¢–ò–í–ï–ù!", "var(--neon-purple)");
                nightmareTimer = setTimeout(() => {
                    if(btn.classList.contains('active')) killPlayer('nightmare');
                }, 10000);
            }
        }

        function triggerFreddy() {
            stopAll();
            playHostSound('freddy');
            log("–§–†–ï–î–î–ò –ê–¢–ê–ö–£–ï–¢...", "var(--freddy-brown)");
            conn.send({action: 'freddy_trigger'});
        }

        function killPlayer(type) {
            stopAll();
            if(type === 'default') playHostSound('window');
            conn.send({action: 'kill', type: type});
            log("–°–ö–†–ò–ú–ï–†: " + type.toUpperCase(), "red");
        }

        function finishNight() {
            stopAll();
            playHostSound('win');
            conn.send({action: 'win'});
            log("–ü–û–ë–ï–î–ê 6 AM", "var(--neon-gold)");
        }

        // --- –î–ï–ô–°–¢–í–ò–Ø –ò–ì–†–û–ö–ê --- //
        function useFlashlight() {
            const btn = document.getElementById('flashBtn');
            btn.style.display = 'none';
            clearTimeout(freddyTimer);
            
            // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
            document.body.style.background = "#fff";
            setTimeout(() => document.body.style.background = "#000", 100);
            
            conn.send({action: 'freddy_safe'});
        }
    </script>
</body>
</html>