<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fnaf IRL v8.0 Freddy Update</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        /* --- –ù–ê–°–¢–†–û–ô–ö–ò –°–¢–ò–õ–ï–ô --- */
        :root {
            --color-main: #00ff41;
            --color-red: #ff0000;
            --color-night: #ff00ff;
            --color-freddy: #8B4513; /* –ö–æ—Ä–∏—á–Ω–µ–≤—ã–π */
            --color-flash: #ffd700; /* –ó–æ–ª–æ—Ç–æ–π/–ñ–µ–ª—Ç—ã–π */
            --bg-color: #000;
        }

        body { background: var(--bg-color); color: var(--color-main); font-family: 'Courier New', monospace; margin: 0; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; user-select: none; }
        
        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤—Ö–æ–¥–∞ */
        #setupOverlay { position: fixed; inset: 0; background: #000; z-index: 5000; display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 20px; }
        .start-btn { padding: 20px 40px; border: 2px solid var(--color-main); background: none; color: var(--color-main); font-size: 1.5rem; cursor: pointer; text-transform: uppercase; font-family: inherit; }
        
        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –•–æ—Å—Ç–∞ */
        .terminal { width: 90%; max-width: 600px; border: 2px solid #333; padding: 15px; background: #000; display: none; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        
        /* –ö–Ω–æ–ø–∫–∏ –•–æ—Å—Ç–∞ */
        .btn { padding: 15px; background: #000; border: 1px solid var(--color-main); color: var(--color-main); font-weight: bold; cursor: pointer; text-transform: uppercase; font-family: inherit; transition: 0.1s; }
        .btn:active { transform: scale(0.95); }
        .btn-active { background: var(--color-main) !important; color: #000 !important; }
        .btn-red { border-color: var(--color-red); color: var(--color-red); }
        .btn-night { border-color: var(--color-night); color: var(--color-night); }
        .btn-night.active { background: var(--color-night) !important; color: #fff !important; box-shadow: 0 0 20px var(--color-night); }
        .btn-freddy { border-color: var(--color-freddy); color: var(--color-freddy); }
        .btn-freddy:active, .btn-freddy.active { background: var(--color-freddy) !important; color: #fff !important; }

        /* –õ–æ–≥ –∏ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ */
        #hostStatusLog { margin-top: 10px; font-size: 0.8rem; color: #666; text-align: center; border-top: 1px solid #333; padding-top: 5px; }
        #settingsBox { display: none; border: 1px solid #333; padding: 10px; margin-bottom: 10px; }

        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ò–≥—Ä–æ–∫–∞ */
        #playerUI { display: none; width: 100%; height: 100%; flex-direction: column; justify-content: center; align-items: center; position: relative; }
        #clock { font-size: 20vw; text-shadow: 0 0 30px var(--color-main); }
        #waitMsg { font-size: 1.5rem; color: #555; }
        
        /* –°–∫—Ä–∏–º–µ—Ä –∏ –ü–æ–±–µ–¥–∞ */
        #screamImg { display: none; position: fixed; inset: 0; width: 100%; height: 100%; object-fit: cover; z-index: 9999; }
        #winScreen { display: none; position: fixed; inset: 0; background: #000; z-index: 10000; flex-direction: column; justify-content: center; align-items: center; }

        /* –ö–Ω–æ–ø–∫–∞ –§–æ–Ω–∞—Ä–∏–∫–∞ (–¥–ª—è –∏–≥—Ä–æ–∫–∞) */
        #flashBtn { 
            display: none; 
            position: fixed; 
            bottom: 50px; 
            left: 50%; 
            transform: translateX(-50%); 
            width: 200px; 
            height: 200px; 
            border-radius: 50%; 
            background: var(--color-flash); 
            border: 5px solid #fff; 
            box-shadow: 0 0 50px var(--color-flash); 
            z-index: 8000; 
            font-size: 1.5rem; 
            font-weight: bold; 
            color: #000;
            cursor: pointer;
            animation: shake 0.5s infinite;
        }

        @keyframes shake { 0% { transform: translateX(-55%); } 50% { transform: translateX(-45%); } 100% { transform: translateX(-50%); } }
    </style>
</head>
<body>

    <script>
        const GAME_CONFIG = {
            // –ê—É–¥–∏–æ —Ñ–∞–π–ª—ã
            snd: {
                door: 'door.mp3',
                closet: 'closet.mp3',
                window: 'window.mp3', // –û–±—ã—á–Ω—ã–π —Å–∫—Ä–∏–º–µ—Ä
                nightmare: 'nightmare.mp3', // –ó–≤—É–∫ –Ω–∞–π—Ç–º–µ—Ä–∞
                freddy: 'freddy.mp3', // –°–º–µ—Ö —Ñ—Ä–µ–¥–¥–∏ –∏–ª–∏ –º—É–∑—ã–∫–∞
                flashlight: 'flashlight.mp3', // –ó–≤—É–∫ –≤–∫–ª—é—á–µ–Ω–∏—è —Ñ–æ–Ω–∞—Ä—è
                win: 'win.mp3'
            },
            // –ö–∞—Ä—Ç–∏–Ω–∫–∏
            img: {
                defaultScream: 'screamer.png',
                nightmareScream: 'nightmare.png',
                freddyScream: 'freddy.png'
            },
            // –¢–∞–π–º–µ—Ä—ã (–≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö)
            timers: {
                nightmareAttack: 10000, // –í—Ä–µ–º—è –¥–æ —Å–º–µ—Ä—Ç–∏ –æ—Ç –ù–∞–π—Ç–º–µ—Ä–∞
                freddyAttack: 10000,    // –í—Ä–µ–º—è –Ω–∞ –Ω–∞–∂–∞—Ç–∏–µ —Ñ–æ–Ω–∞—Ä–∏–∫–∞
                winDelay: 2500          // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ —ç–∫—Ä–∞–Ω–æ–º –ø–æ–±–µ–¥—ã
            }
        };
    </script>

    <div id="setupOverlay">
        <h1 style="font-size: 3rem; margin:0; color: var(--color-main);">FNAF IRL v8.0</h1>
        <button class="start-btn" onclick="initHost()">–°–û–ó–î–ê–¢–¨ (HOST)</button>
        <button class="start-btn" onclick="initPlayer()">–í–û–ô–¢–ò (PLAYER)</button>
    </div>

    <div id="hostUI" class="terminal">
        <div style="display:flex; justify-content:space-between;">
            <span>STATUS: <b id="statusTxt" style="color:red">OFFLINE</b></span>
            <button onclick="toggleSettings()" style="background:none; border:none; color:var(--color-main); cursor:pointer;">‚öôÔ∏è</button>
        </div>

        <div id="settingsBox">
            –í—Ä–µ–º—è –Ω–æ—á–∏: <input type="number" id="mInp" value="1" style="width:30px">–º <input type="number" id="sInp" value="30" style="width:30px">—Å
            <button class="btn" style="width:100%; margin-top:5px;" onclick="startNight()">–ù–ê–ß–ê–¢–¨ –ù–û–ß–¨</button>
        </div>

        <div class="grid">
            <button class="btn" onclick="sendSnd('door')">–®–ê–ì–ò (Door)</button>
            <button class="btn" onclick="sendSnd('closet')">–î–´–•–ê–ù–ò–ï (Closet)</button>
            
            <button id="btn-normal" class="btn" onclick="setMode('normal')">NORMAL MODE</button>
            <button id="btn-hard" class="btn" onclick="setMode('hard')">HARD MODE</button>
            
            <button id="btn-night" class="btn btn-night" onclick="toggleNightmare()">NIGHTMARE</button>
            <button class="btn btn-freddy" onclick="triggerFreddy()">FREDDY</button>
            
            <button class="btn btn-red" onclick="killPlayer('default')">–°–ö–†–ò–ú–ï–†</button>
            <button class="btn btn-red" onclick="stopAll()">–°–¢–û–ü</button>
        </div>
        <div id="hostStatusLog">–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞...</div>
    </div>

    <div id="playerUI">
        <div id="waitMsg">–û–ñ–ò–î–ê–ù–ò–ï –•–û–°–¢–ê...</div>
        <div id="clock">12:00</div>
        <button id="flashBtn" onclick="useFlashlight()">–§–û–ù–ê–†–¨!</button>
        
        <img id="screamImg">
        <div id="winScreen"><div style="font-size:10rem">üëë</div><div style="color:gold; font-size:3rem">6 AM</div></div>
    </div>

    <div id="audioContainer"></div>

    <script>
        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        let peer, conn, timerInt, gameHour = 0;
        let activeMode = null, loopActive = false;
        let freddyTimer = null, nightmareTimer = null;

        // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ
        const audioBox = document.getElementById('audioContainer');
        for (const [key, src] of Object.entries(GAME_CONFIG.snd)) {
            const aud = document.createElement('audio');
            aud.id = 'snd-' + key;
            aud.src = src;
            aud.preload = 'auto';
            if (key === 'nightmare') aud.loop = true;
            audioBox.appendChild(aud);
        }

        function play(name) {
            const a = document.getElementById('snd-' + name);
            if(a) { a.currentTime = 0; a.play().catch(e=>console.log(e)); }
        }
        function stopAudio() {
            document.querySelectorAll('audio').forEach(a => {
                if(a.id !== 'snd-window' && a.id !== 'snd-win' && a.id !== 'snd-flashlight') {
                    a.pause(); a.currentTime = 0;
                }
            });
        }
        function log(m, c="#00ff41") { 
            const l = document.getElementById('hostStatusLog'); 
            l.innerText = m; l.style.color = c; 
        }

        // --- –õ–û–ì–ò–ö–ê –•–û–°–¢–ê ---
        function initHost() {
            document.getElementById('setupOverlay').style.display = 'none';
            document.getElementById('hostUI').style.display = 'block';
            const shortId = 'fnaf-' + Math.floor(1000 + Math.random() * 9000);
            peer = new Peer(shortId);
            
            peer.on('open', id => {
                log("ID –ö–û–ú–ù–ê–¢–´: " + id, "yellow");
            });
            peer.on('connection', c => {
                conn = c;
                document.getElementById('statusTxt').innerText = "ONLINE";
                document.getElementById('statusTxt').style.color = "#00ff41";
                log("–ò–ì–†–û–ö –ü–û–î–ö–õ–Æ–ß–ï–ù!");
                setupHostEvents();
            });
        }

        function setupHostEvents() {
            conn.on('data', d => {
                if(d.action === 'freddy_safe') {
                    log("–ò–ì–†–û–ö –û–¢–ü–£–ì–ù–£–õ –§–†–ï–î–î–ò", "gold");
                    play('flashlight'); // –ó–≤—É–∫ —Ñ–æ–Ω–∞—Ä—è —É —Ö–æ—Å—Ç–∞ —Ç–æ–∂–µ
                }
                if(d.action === 'freddy_die') {
                    log("–§–†–ï–î–î–ò –£–ë–ò–õ –ò–ì–†–û–ö–ê", "red");
                }
            });
        }

        // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ì–†–û–ô (–•–û–°–¢) ---
        function startNight() {
            gameHour = 0;
            conn.send({action: 'start'});
            startClock();
            document.getElementById('settingsBox').style.display = 'none';
            log("–ù–û–ß–¨ –ù–ê–ß–ê–õ–ê–°–¨");
        }

        function startClock() {
            clearInterval(timerInt);
            const ms = ((parseInt(document.getElementById('mInp').value)||0)*60 + (parseInt(document.getElementById('sInp').value)||0))*1000;
            timerInt = setInterval(() => {
                gameHour++;
                conn.send({action: 'time', h: gameHour});
                if(gameHour >= 6) { clearInterval(timerInt); setTimeout(winGame, GAME_CONFIG.timers.winDelay); }
            }, ms);
        }

        function winGame() {
            stopAll();
            play('win');
            conn.send({action: 'win'});
            log("–ü–û–ë–ï–î–ê 6 AM", "gold");
        }

        function stopAll() {
            clearInterval(timerInt);
            stopAudio();
            loopActive = false; activeMode = null;
            clearTimeout(nightmareTimer);
            document.getElementById('btn-night').classList.remove('active');
            document.querySelectorAll('.btn').forEach(b => b.classList.remove('btn-active'));
            if(conn) conn.send({action: 'stop'});
            log("–°–¢–û–ü", "red");
        }

        function sendSnd(name) { play(name); }

        function setMode(m) {
            if(activeMode === m) { stopAll(); return; }
            stopAll();
            activeMode = m; loopActive = true;
            document.getElementById('btn-'+m).classList.add('btn-active');
            log("–†–ï–ñ–ò–ú: " + m.toUpperCase());
            modeLoop();
        }

        async function modeLoop() {
            if(!loopActive) return;
            const pool = ['door', 'closet'];
            const picked = pool[Math.floor(Math.random()*pool.length)];
            play(picked);
            await new Promise(r => setTimeout(r, 2000)); // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–≤—É–∫–∞ –ø—Ä–∏–º–µ—Ä–Ω–∞—è
            if(loopActive) {
                const delay = activeMode === 'normal' ? (Math.random()*3000+2000) : 1000;
                setTimeout(modeLoop, delay);
            }
        }

        // --- –°–ü–ï–¶–ò–ê–õ–¨–ù–´–ï –ú–ï–•–ê–ù–ò–ö–ò ---
        function toggleNightmare() {
            const nBtn = document.getElementById('btn-night');
            if(nBtn.classList.contains('active')) {
                stopAll();
            } else {
                stopAll();
                play('nightmare');
                nBtn.classList.add('active');
                log("NIGHTMARE –ê–ö–¢–ò–í–ï–ù!", "#ff00ff");
                nightmareTimer = setTimeout(() => {
                   if(loopActive || nBtn.classList.contains('active')) killPlayer('nightmare');
                }, GAME_CONFIG.timers.nightmareAttack);
            }
        }

        function triggerFreddy() {
            stopAll();
            play('freddy');
            log("–§–†–ï–î–î–ò –í–´–®–ï–õ...", "#8B4513");
            conn.send({action: 'freddy_attack'});
        }

        function killPlayer(type) {
            stopAll();
            if(type === 'default') play('window');
            // Nightmare –∏ Freddy –∑–≤—É–∫–∏ –∏–≥—Ä–∞—é—Ç—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏–ª–∏ —É–∂–µ –∏–≥—Ä–∞—é—Ç
            conn.send({action: 'kill', type: type});
            log("–ò–ì–†–û–ö –£–ë–ò–¢: " + type.toUpperCase(), "red");
        }
        
        function toggleSettings() {
            const b = document.getElementById('settingsBox');
            b.style.display = b.style.display === 'none' ? 'block' : 'none';
        }

        // --- –õ–û–ì–ò–ö–ê –ò–ì–†–û–ö–ê ---
        function initPlayer() {
            const target = prompt("–í–≤–µ–¥–∏—Ç–µ ID –•–æ—Å—Ç–∞:");
            if(!target) return;
            document.getElementById('setupOverlay').style.display = 'none';
            document.getElementById('playerUI').style.display = 'flex';
            
            peer = new Peer();
            peer.on('open', () => {
                conn = peer.connect(target);
                conn.on('open', () => {
                    document.getElementById('waitMsg').innerText = "–°–í–Ø–ó–¨ –ï–°–¢–¨! –ñ–î–ò–¢–ï –•–û–°–¢–ê";
                });
                
                conn.on('data', data => {
                    const ui = {
                        img: document.getElementById('screamImg'),
                        clock: document.getElementById('clock'),
                        win: document.getElementById('winScreen'),
                        btn: document.getElementById('flashBtn')
                    };

                    if(data.action === 'start') {
                        ui.win.style.display='none'; ui.img.style.display='none'; 
                        ui.clock.style.display='block'; ui.clock.innerText="12:00";
                        ui.btn.style.display = 'none';
                    }
                    
                    if(data.action === 'time') ui.clock.innerText = data.h + ":00";
                    
                    if(data.action === 'kill') {
                        ui.clock.style.display = 'none';
                        ui.btn.style.display = 'none';
                        ui.img.style.display = 'block';
                        
                        // –í—ã–±–æ—Ä –∫–∞—Ä—Ç–∏–Ω–∫–∏ —Å–º–µ—Ä—Ç–∏
                        let src = GAME_CONFIG.img.defaultScream;
                        if(data.type === 'nightmare') src = GAME_CONFIG.img.nightmareScream;
                        if(data.type === 'freddy') src = GAME_CONFIG.img.freddyScream;
                        
                        // –°–±—Ä–æ—Å –∫—ç—à–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∏
                        ui.img.src = src + '?t=' + Date.now();
                        
                        // –ï—Å–ª–∏ —Å–∫—Ä–∏–º–µ—Ä –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π, –æ–Ω –∏–≥—Ä–∞–µ—Ç —É —Ö–æ—Å—Ç–∞, –µ—Å–ª–∏ –Ω–µ—Ç - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–≤—É–∫ —Ç—É—Ç
                        setTimeout(() => ui.img.style.display='none', 4000);
                    }

                    if(data.action === 'freddy_attack') {
                        // –ú–µ—Ö–∞–Ω–∏–∫–∞ –§—Ä–µ–¥–¥–∏
                        ui.btn.style.display = 'block'; // –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É
                        play('freddy');
                        freddyTimer = setTimeout(() => {
                            if(ui.btn.style.display === 'block') {
                                // –ù–µ —É—Å–ø–µ–ª –Ω–∞–∂–∞—Ç—å
                                ui.btn.style.display = 'none';
                                ui.img.style.display = 'block';
                                ui.img.src = GAME_CONFIG.img.freddyScream;
                                conn.send({action: 'freddy_die'});
                            }
                        }, GAME_CONFIG.timers.freddyAttack);
                    }

                    if(data.action === 'win') { ui.win.style.display='flex'; }
                    if(data.action === 'stop') { 
                        ui.clock.innerText = "STOP"; 
                        ui.btn.style.display='none';
                        clearTimeout(freddyTimer);
                    }
                });
            });
        }

        // –î–µ–π—Å—Ç–≤–∏–µ –∏–≥—Ä–æ–∫–∞ (–§–æ–Ω–∞—Ä–∏–∫)
        function useFlashlight() {
            const btn = document.getElementById('flashBtn');
            btn.style.display = 'none';
            clearTimeout(freddyTimer);
            play('flashlight');
            // –≠—Ñ—Ñ–µ–∫—Ç –≤—Å–ø—ã—à–∫–∏
            document.body.style.background = '#fff';
            setTimeout(() => document.body.style.background = '#000', 100);
            conn.send({action: 'freddy_safe'});
        }

    </script>
</body>
</html>